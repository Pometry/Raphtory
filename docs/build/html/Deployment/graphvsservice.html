<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Raphtory Graph VS Raphtory Service &mdash; Raphtory 0.4.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Bare Metal Cluster Deployment" href="deploymentlocal.html" />
    <link rel="prev" title="Raphtory Client" href="../PythonClient/RaphtoryClient.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Raphtory
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Raphtory</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Install/installdependencies.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Ingestion/sprouter.html">Building a graph from your data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Analysis/analysis-explained.html">Analysis in Raphtory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Querying/presto.html">Querying in-flight data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../PythonClient/tutorial.html">Getting your data into Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PythonClient/tutorial.html#example-notebook">Example Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PythonClient/RaphtoryClient.html">Raphtory Client</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Deployment</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Raphtory Graph VS Raphtory Service</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#environment-variables">Environment Variables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#optional-variables">Optional Variables</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="deploymentlocal.html">Bare Metal Cluster Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploymentkube.html">Kubernetes Cluster Deployment</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples Projects</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Examples/community-of-cheese.html">The Community of Cheese</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Examples/gab.html">Gab Social Network Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Temporal Algorithms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Algorithms/tmotifcount.html">Motif Alpha</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Algorithms/mlpa.html">Multi-Layer Dynamic Community Detection</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Static Algorithms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Algorithms/connectedComponents.html">Connected Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Algorithms/degree.html">Degree</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Algorithms/lpa.html">Label Propagation Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Algorithms/cbod.html">Outlier Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Algorithms/pageRank.html">Page Rank</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Algorithms/genericTaint.html">Tainting / Infection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Algorithms/triangleCount.html">Triangle Count</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Algorithms/twoHopNeighbors.html">Two-Hop Neighbours</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Algorithms/wattsCascade.html">Watts Cascade</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Raphtory</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Raphtory Graph VS Raphtory Service</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/Deployment/graphvsservice.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="raphtory-graph-vs-raphtory-service">
<h1>Raphtory Graph VS Raphtory Service<a class="headerlink" href="#raphtory-graph-vs-raphtory-service" title="Permalink to this headline"></a></h1>
<p>*<em>THIS TUTORIAL IS CURRENTLY OUT OF DATE, BUT WILL BE UPDATED SOON</em></p>
<p>In our previous examples, we have been running Raphtory via the <code class="docutils literal notranslate"><span class="pre">RaphtoryGraph</span></code>
instance. This is used for local and single machine development, as the <code class="docutils literal notranslate"><span class="pre">RaphtoryGraph</span></code> instance
initiates all the necessary components. This, of course, does not provide
you with granular control over the system. For example, you may feel that the spout requires
much less RAM than the graph builder or partition manager. You may also want to
run the client across a cluster, whereby each machine runs a different component, which aids
with scaling to larger datasets and analytical tasks.</p>
<p>For these reasons, you can run your programs as <code class="docutils literal notranslate"><span class="pre">RaphtoryService</span></code>(s) instead.
The service file gives the user more granular control over each individual component.
With the service, the user is also able to send analysis queries on-demand.
For example, you can run the service, ingest the entire graph, and then run multiple
queries or leave the machine running for other users.</p>
<p>Similar to the <code class="docutils literal notranslate"><span class="pre">RaphtoryGraph</span></code>, the user only has to specify the spout and builder classes required to read and parse the data. For instance, the code below will create and run the LOTR example as a distributed service.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">raphtory</span><span class="p">.</span><span class="nn">core</span><span class="p">.</span><span class="nn">build</span><span class="p">.</span><span class="nn">server</span><span class="p">.</span><span class="nc">RaphtoryService</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">raphtory</span><span class="p">.</span><span class="nn">core</span><span class="p">.</span><span class="nn">components</span><span class="p">.</span><span class="nn">graphbuilder</span><span class="p">.</span><span class="nc">GraphBuilder</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">raphtory</span><span class="p">.</span><span class="nn">core</span><span class="p">.</span><span class="nn">components</span><span class="p">.</span><span class="nn">spout</span><span class="p">.</span><span class="nc">Spout</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">raphtory</span><span class="p">.</span><span class="nn">spouts</span><span class="p">.</span><span class="nc">FileSpout</span>

<span class="k">object</span> <span class="nc">LOTRDistributed</span> <span class="k">extends</span> <span class="nc">RaphtoryService</span><span class="p">[</span><span class="nc">String</span><span class="p">]{</span>

  <span class="k">override</span> <span class="k">def</span> <span class="nf">defineSpout</span><span class="p">:</span> <span class="nc">Spout</span><span class="p">[</span><span class="nc">String</span><span class="p">]</span> <span class="o">=</span> 
    <span class="k">new</span> <span class="nc">FileSpout</span><span class="p">(</span><span class="s">&quot;src/main/scala/com/raphtory/dev/lotr&quot;</span><span class="p">,</span> <span class="s">&quot;lotr.csv&quot;</span><span class="p">)</span>

  <span class="k">override</span> <span class="k">def</span> <span class="nf">defineBuilder</span><span class="p">:</span> <span class="nc">GraphBuilder</span><span class="p">[</span><span class="nc">String</span><span class="p">]</span> <span class="o">=</span> 
    <span class="k">new</span> <span class="nc">LOTRGraphBuilder</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To run the code above, one must start up the following components individually.</p>
<ul class="simple">
<li><p>Leader - Manages new members joining and maintaining the global watermark.</p></li>
<li><p>Spout - Ingests the data</p></li>
<li><p>GraphBuilders - Build the graph</p></li>
<li><p>PartitionManager - Stores the live graph and all the history</p></li>
<li><p>QueryManager - Accepts new analysis queries and runs them across the partitions</p></li>
</ul>
<section id="environment-variables">
<h2>Environment Variables<a class="headerlink" href="#environment-variables" title="Permalink to this headline"></a></h2>
<p>Each of the above components also expects a set of environment variables which must be present on all of the machines;</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>    RAPHTORY_BUILD_SERVERS = 2
    RAPHTORY_PARTITION_SERVERS = 2
    RAPHTORY_BUILDERS_PER_SERVER = 5
    RAPHTORY_PARTITIONS_PER_SERVER = 5
    
    RAPHTORY_BIND_ADDRESS= &lt;The local machine IP&gt;
    RAPHTORY_BIND_PORT=1600
    
    RAPHTORY_LEADER_ADDRESS = &lt;The leader Machines IP&gt;
    RAPHTORY_LEADER_PORT = 1600
</pre></div>
</div>
<p>The number of <code class="docutils literal notranslate"><span class="pre">RAPHTORY_BUILD_SERVERS</span></code> refers to how many graph builder services you have deployed - Similarly <code class="docutils literal notranslate"><span class="pre">RAPHTORY_PARTITION_SERVERS</span></code> refers to how many Partition Managers you have. These must be set properly or Raphtory may not work correctly. <code class="docutils literal notranslate"><span class="pre">RAPHTORY_BUILDERS_PER_SERVER</span></code> and <code class="docutils literal notranslate"><span class="pre">RAPHTORY_PARTITIONS_PER_SERVER</span></code> can be thought of as how many threads are running on each service and can be experimented with for performance.</p>
<p><code class="docutils literal notranslate"><span class="pre">RAPHTORY_BIND_ADDRESS</span></code> and <code class="docutils literal notranslate"><span class="pre">RAPHTORY_BIND_PORT</span></code> refer to the IP and port you wish the service to bind onto on the machine hosting it respectively. The value of these for the leader should be set in all machines via <code class="docutils literal notranslate"><span class="pre">RAPHTORY_LEADER_ADDRESS</span></code> and <code class="docutils literal notranslate"><span class="pre">RAPHTORY_LEADER_PORT</span></code>.</p>
<section id="optional-variables">
<h3>Optional Variables<a class="headerlink" href="#optional-variables" title="Permalink to this headline"></a></h3>
<p>Each component should be run whilst specifying the following JAVA_OPTS.
Please adjust the <code class="docutils literal notranslate"><span class="pre">Xms</span></code> and <code class="docutils literal notranslate"><span class="pre">Xmx</span></code> to the amount of free memory on the box.  [This helps A LOT with GC]</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">JAVA_OPTS</span><span class="o">=</span>-XX:+UseShenandoahGC -XX:+UseStringDeduplication -Xms10G -Xmx10G -Xss128M
</pre></div>
</div>
<p>If using the parquet reader, we also recommend installing hadoop and adding the HOME and OPTs to the system environment ;</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">Environment</span><span class="o">=</span><span class="s1">&#39;HADOOP_HOME=/usr/local/bin/hadoop-3.3.1&#39;</span>
<span class="nv">Environment</span><span class="o">=</span><span class="s2">&quot;HADOOP_OPTS=-Djava.library.path=/usr/local/bin/hadoop-3.3.1/lib/native&quot;</span>
<span class="nv">Environment</span><span class="o">=</span><span class="s2">&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/usr/local/bin/hadoop-3.3.1/bin/:/usr/local/bin/hadoop-3.3.1/sbin/</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../PythonClient/RaphtoryClient.html" class="btn btn-neutral float-left" title="Raphtory Client" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="deploymentlocal.html" class="btn btn-neutral float-right" title="Bare Metal Cluster Deployment" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Ben Steer.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>